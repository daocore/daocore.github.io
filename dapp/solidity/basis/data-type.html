<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>数据类型 | UTXO</title>
    <meta name="generator" content="VuePress 1.8.2">
    <link rel="icon" href="/favicon.ico">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.5.1">
    <script language="javascript" type="text/javascript" src="https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script language="javascript" type="text/javascript" src="/js/MouseClickEffect.js"></script>
    <script language="javascript" type="text/javascript" src="https://wowjs.uk/dist/wow.min.js"></script>
    <meta name="description" content="投身区块链，寻找中本聪">
    <meta name="viewport" content="width=device-width,initial-scale=1,user-scalable=no">
    <meta name="theme-color" content="red">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="msapplication-TileColor" content="#000000">
    
    <link rel="preload" href="/assets/css/0.styles.bda3f3be.css" as="style"><link rel="preload" href="/assets/js/app.944974c5.js" as="script"><link rel="preload" href="/assets/js/5.2fa58847.js" as="script"><link rel="preload" href="/assets/js/1.66903a01.js" as="script"><link rel="preload" href="/assets/js/23.14e02022.js" as="script"><link rel="prefetch" href="/assets/js/10.99d74db5.js"><link rel="prefetch" href="/assets/js/11.094b8420.js"><link rel="prefetch" href="/assets/js/12.403405ef.js"><link rel="prefetch" href="/assets/js/13.3bada37d.js"><link rel="prefetch" href="/assets/js/14.c46b60f6.js"><link rel="prefetch" href="/assets/js/15.a5861936.js"><link rel="prefetch" href="/assets/js/16.119f7243.js"><link rel="prefetch" href="/assets/js/17.0d02cbf8.js"><link rel="prefetch" href="/assets/js/18.6c6b0912.js"><link rel="prefetch" href="/assets/js/19.db726471.js"><link rel="prefetch" href="/assets/js/2.6b6e6721.js"><link rel="prefetch" href="/assets/js/20.c76fc0c3.js"><link rel="prefetch" href="/assets/js/21.58cbd53b.js"><link rel="prefetch" href="/assets/js/22.6be17c4b.js"><link rel="prefetch" href="/assets/js/24.3efb6b77.js"><link rel="prefetch" href="/assets/js/25.7c5b1460.js"><link rel="prefetch" href="/assets/js/26.aed30a5a.js"><link rel="prefetch" href="/assets/js/27.c0078c49.js"><link rel="prefetch" href="/assets/js/28.36351ab5.js"><link rel="prefetch" href="/assets/js/29.48b6d0a3.js"><link rel="prefetch" href="/assets/js/3.cc9cc55b.js"><link rel="prefetch" href="/assets/js/30.dbf817ca.js"><link rel="prefetch" href="/assets/js/31.240e0d68.js"><link rel="prefetch" href="/assets/js/32.1cb0418c.js"><link rel="prefetch" href="/assets/js/33.42508e02.js"><link rel="prefetch" href="/assets/js/34.77f1fcc3.js"><link rel="prefetch" href="/assets/js/35.83512745.js"><link rel="prefetch" href="/assets/js/36.600162d2.js"><link rel="prefetch" href="/assets/js/37.5a3b81ad.js"><link rel="prefetch" href="/assets/js/38.8950ff98.js"><link rel="prefetch" href="/assets/js/39.559d2c5b.js"><link rel="prefetch" href="/assets/js/6.419f6057.js"><link rel="prefetch" href="/assets/js/7.832282ac.js"><link rel="prefetch" href="/assets/js/8.920cb791.js"><link rel="prefetch" href="/assets/js/9.50e7d491.js">
    <link rel="stylesheet" href="/assets/css/0.styles.bda3f3be.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-f3a80db0><div data-v-f3a80db0><div id="loading" class="loading-wrapper" data-v-7efa5e3f data-v-f3a80db0 data-v-f3a80db0><div id="loading-center" data-v-7efa5e3f><div id="loading-center-absolute" data-v-7efa5e3f><div id="object_four" class="object" data-v-7efa5e3f></div> <div id="object_three" class="object" data-v-7efa5e3f></div> <div id="object_two" class="object" data-v-7efa5e3f></div> <div id="object_one" class="object" data-v-7efa5e3f></div></div></div></div> <div class="password-shadow password-wrapper-out" style="display:none;" data-v-4d9229f4 data-v-f3a80db0 data-v-f3a80db0><h3 class="title" data-v-4d9229f4 data-v-4d9229f4>UTXO</h3> <p class="description" data-v-4d9229f4 data-v-4d9229f4>投身区块链，寻找中本聪</p> <label id="box" class="inputBox" data-v-4d9229f4 data-v-4d9229f4><input type="password" value="" data-v-4d9229f4> <span data-v-4d9229f4>解锁！解锁！</span> <button data-v-4d9229f4>OK</button></label> <div class="footer" data-v-4d9229f4 data-v-4d9229f4><span data-v-4d9229f4><i class="iconfont reco-theme" data-v-4d9229f4></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4d9229f4>vuePress-theme-reco</a></span> <span data-v-4d9229f4><i class="iconfont reco-copyright" data-v-4d9229f4></i> <a data-v-4d9229f4><span data-v-4d9229f4>我不是中本聪</span>
            
          <span data-v-4d9229f4>2017 - </span>
          2022
        </a></span></div></div> <div class="hide" data-v-f3a80db0><header class="navbar" style="z-index:99;" data-v-f3a80db0><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/head.jpg" alt="UTXO" class="logo"> <span class="site-name">UTXO</span></a> <div class="links"><div class="color-picker"><div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark active">dark</li><li class="auto">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><i class="iconfont reco-search"></i> <input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Solidity/" class="nav-link"><i class="undefined"></i>
  Solidity
</a></li><li class="dropdown-item"><!----> <a href="/categories/Uniswap/" class="nav-link"><i class="undefined"></i>
  Uniswap
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAPP/" class="nav-link"><i class="undefined"></i>
  DAPP
</a></li><li class="dropdown-item"><!----> <a href="/categories/智能合约/" class="nav-link"><i class="undefined"></i>
  智能合约
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      DAPP开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dapp/tutorial/junior/explain/" class="nav-link"><i class="undefined"></i>
  DAPP教程
</a></li><li class="dropdown-item"><!----> <a href="/dapp/uniswap/v2/whitepaper/" class="nav-link"><i class="undefined"></i>
  Uniswap
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-suggestion"></i>
      TodoList
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react_ts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react_ts
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react_ts_mobx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react_ts_mobx
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react-native_ts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react-native_ts 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react-native_ts_mobx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react-native_ts_mobx
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react_ts_mobx_eos" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react_ts_mobx_eos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex_eos" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex_eos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex_eos_ipfs" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex_eos_ipfs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex_eos_chrome" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex_eos_chrome_extensions
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react-native_ts_mobx_eos" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react-native_ts_mobx_eos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/guestbook/" class="nav-link"><i class="iconfont reco-suggestion"></i>
  留言板
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-github"></i>
      仓库
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/daocore/reco-blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/qianduanxinlv/vuepress_blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-f3a80db0></div> <aside class="sidebar" data-v-f3a80db0><div class="personal-info-wrapper" data-v-1af3eea6 data-v-f3a80db0><img src="/head.jpg" alt="author-avatar" class="personal-img animated bounce" data-v-1af3eea6> <h3 class="name" data-v-1af3eea6>
    我不是中本聪
  </h3> <div class="num" data-v-1af3eea6><div data-v-1af3eea6><h3 data-v-1af3eea6>23</h3> <h6 data-v-1af3eea6>文章</h6></div> <div data-v-1af3eea6><h3 data-v-1af3eea6>6</h3> <h6 data-v-1af3eea6>标签</h6></div></div> <ul class="social-links" data-v-1af3eea6></ul> <hr data-v-1af3eea6></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  首页
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      分类
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/Solidity/" class="nav-link"><i class="undefined"></i>
  Solidity
</a></li><li class="dropdown-item"><!----> <a href="/categories/Uniswap/" class="nav-link"><i class="undefined"></i>
  Uniswap
</a></li><li class="dropdown-item"><!----> <a href="/categories/DAPP/" class="nav-link"><i class="undefined"></i>
  DAPP
</a></li><li class="dropdown-item"><!----> <a href="/categories/智能合约/" class="nav-link"><i class="undefined"></i>
  智能合约
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  标签
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-document"></i>
      DAPP开发
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/dapp/tutorial/junior/explain/" class="nav-link"><i class="undefined"></i>
  DAPP教程
</a></li><li class="dropdown-item"><!----> <a href="/dapp/uniswap/v2/whitepaper/" class="nav-link"><i class="undefined"></i>
  Uniswap
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-suggestion"></i>
      TodoList
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react_ts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react_ts
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react_ts_mobx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react_ts_mobx
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react-native_ts" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react-native_ts 
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react-native_ts_mobx" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react-native_ts_mobx
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react_ts_mobx_eos" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react_ts_mobx_eos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex_eos" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex_eos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex_eos_ipfs" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex_eos_ipfs
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/vue_js_vuex_eos_chrome" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  vue_js_vuex_eos_chrome_extensions
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://github.com/daocore/todolist/tree/master/react-native_ts_mobx_eos" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  react-native_ts_mobx_eos
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  时间轴
</a></div><div class="nav-item"><a href="/guestbook/" class="nav-link"><i class="iconfont reco-suggestion"></i>
  留言板
</a></div><div class="nav-item"><a href="/about/" class="nav-link"><i class="iconfont reco-account"></i>
  关于
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-github"></i>
      仓库
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/daocore/reco-blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  Github
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li><li class="dropdown-item"><!----> <a href="https://gitee.com/qianduanxinlv/vuepress_blog" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="undefined"></i>
  码云
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>入门</span> <span class="arrow right"></span></p> <!----></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>基础语法</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/dapp/solidity/basis/data-type.html" aria-current="page" class="active sidebar-link">数据类型</a></li></ul></section></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-4d9229f4 data-v-f3a80db0><h3 class="title" data-v-4d9229f4 data-v-4d9229f4>数据类型</h3> <!----> <label id="box" class="inputBox" data-v-4d9229f4 data-v-4d9229f4><input type="password" value="" data-v-4d9229f4> <span data-v-4d9229f4>解锁！解锁！</span> <button data-v-4d9229f4>OK</button></label> <div class="footer" data-v-4d9229f4 data-v-4d9229f4><span data-v-4d9229f4><i class="iconfont reco-theme" data-v-4d9229f4></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-4d9229f4>vuePress-theme-reco</a></span> <span data-v-4d9229f4><i class="iconfont reco-copyright" data-v-4d9229f4></i> <a data-v-4d9229f4><span data-v-4d9229f4>我不是中本聪</span>
            
          <span data-v-4d9229f4>2017 - </span>
          2022
        </a></span></div></div> <div data-v-f3a80db0><main class="page"><section><div class="page-title"><h1 class="title">数据类型</h1> <div data-v-31ea8b86><i class="iconfont reco-account" data-v-31ea8b86><span data-v-31ea8b86>我不是中本聪</span></i> <i class="iconfont reco-date" data-v-31ea8b86><span data-v-31ea8b86>2020-12-25</span></i> <!----> <i class="tags iconfont reco-tag" data-v-31ea8b86><span class="tag-item" data-v-31ea8b86>Solidity</span></i></div></div> <div class="theme-reco-content content__default"><p>在用任何语言编写程序时，都需要使用变量来存储各种信息。变量是内存空间的名称，变量有不同类型，例如整型、字符串类型等等。操作系统根据变量的数据类型分配内存。</p> <p>Solidity 是一种静态类型语言，这意味着每个变量(状态变量和局部变量)都需要在编译时指定变量的类型。</p> <p>Solidity 提供了几种基本类型，并且基本类型可以用来组合出复杂类型。</p> <p>除此之外，类型之间可以在包含运算符号的表达式中进行交互。 关于各种运算符号，可以参考 运算符优先级 。</p> <p>在javascript中常见的“undefined”或“null”值的概念在Solidity中不存在，但是新声明的变量总是有一个 默认值 ，具体的默认值跟类型相关。 要处理任何意外的值，应该使用 错误处理 来恢复整个交易，或者返回一个带有第二个 bool 值的元组表示成功。</p> <p>Solidity中，变量类型有以下几大类：</p> <ul><li>值类型</li> <li>地址类型</li> <li>引用类型</li></ul> <h2 id="值类型"><a href="#值类型" class="header-anchor">#</a> 值类型</h2> <p>以下类型也称为值类型，因为这些类型的变量将始终按值来传递。 也就是说，当这些变量被用作函数参数或者用在赋值语句中时，总会进行值拷贝。</p> <h3 id="_1-布尔型"><a href="#_1-布尔型" class="header-anchor">#</a> 1.布尔型</h3> <p>bool ：可能的取值为字面常量值 true 和 false 。</p> <p>运算符：</p> <ul><li>!)逻辑非)</li> <li>&amp;&amp;)逻辑与， “and” )</li> <li>||)逻辑或， “or” )</li> <li>==)等于)</li> <li>!=)不等于)</li></ul> <blockquote><p>运算符 || 和 &amp;&amp; 都遵循同样的短路( short-circuiting )规则。就是说在表达式 f(x)|| g(y)中， 如果 f(x)的值为 true ，那么 g(y)就不会被执行，即使会出现一些副作用。</p></blockquote> <h3 id="_2-整型"><a href="#_2-整型" class="header-anchor">#</a> 2.整型</h3> <p>int / uint ：分别表示有符号和无符号的不同位数的整型变量。 支持关键字 uint8 到 uint256)无符号，从 8 位到 256 位)以及 int8 到 int256，以 8 位为步长递增。 uint 和 int 分别是 uint256 和 int256 的别名。</p> <p>运算符：</p> <ul><li>比较运算符： &lt;= ， &lt; ， == ， != ， &gt;= ， &gt;)返回布尔值)</li> <li>位运算符： &amp; ， | ， ^)异或)， ~)位取反)</li> <li>移位运算符： &lt;&lt;)左移位) ， &gt;&gt;)右移位)</li> <li>算数运算符： + ， - ， 一元运算负 -)仅针对有符号整型)， * ， / ， %)取余或叫模运算) ， **)幂)</li></ul> <blockquote><p>对于整形 X，可以使用 type(X).min 和 type(X).max 去获取这个类型的最小值与最大值。</p></blockquote> <div class="custom-block warning"><p class="title">注解</p><p>Solidity中的整数是有取值范围的。 例如 uint32 类型的取值范围是 0 到 2 ** 32-1 。 0.8.0 开始，算术运算有两个计算模式：一个是 “wrapping”(截断)模式或称 “unchecked”(不检查)模式，一个是”checked”)检查)模式。 默认情况下，算术运算在 “checked” 模式下，即都会进行溢出检查，如果结果落在取值范围之外，调用会通过 失败异常 回退。 你也可以通过 unchecked { ... } 切换到 “unchecked”模式，更多可参考 unchecked .</p></div><p>整型运算形式</p> <table><thead><tr><th>运算形式</th> <th>作用和结果</th> <th>注解</th></tr></thead> <tbody><tr><td>比较运算</td> <td>比较整型的值</td> <td>即 &lt;= 、 &lt; 、 == 、 != 、 &gt;= 、 &gt;</td></tr> <tr><td>位运算</td> <td>位运算在数字的二进制补码表示上执行</td> <td>这意味着： ~int256(0)== int256(-1)</td></tr> <tr><td>移位</td> <td>移位操作的结果具有左操作数的类型，同时会截断结果以匹配类型。 右操作数必须是无符号类型。 尝试按带符号的类型移动将产生编译错误。</td> <td><div>1. 不管 x 正还是负，x &lt;&lt; y 相当于 x * 2 ** y。</div> <div>2. 如果 x 为正值，x &gt;&gt; y 相当于 x / 2 ** y。</div><div> 3. 如果 x 为负值，x &gt;&gt; y 相当于)x + 1)/ 2<strong>y - 1)与将 x 除以 2</strong>y 同时向负无穷大四舍五入)。</div><div>4. 在版本 0.5.0 之前，对于负 x 的右移 x &gt;&gt; y 相当于 x / 2 ** y ，即，右移使用向上舍入(向零)而不是向下舍入(向负无穷大)。</div></td></tr> <tr><td>加、减、乘法运算</td> <td>加法，减法和乘法和通常理解的语义一样，不过有两种模式来应对溢出(上溢及下溢)：默认情况下，算术运算都会进行溢出检查，但是也可以禁用检查，可以通过 <a href="https://learnblockchain.cn/docs/solidity/control-structures.html#unchecked" target="_blank" rel="noopener noreferrer">unchecked block<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>来禁用检查，此时会返回截断的结果，更多的详情可以前往链接查看。</td> <td>溢出的检查功能是在 0.8.0 版本加入的，在此版本之前，请使用 <a href="https://github.com/OpenZeppelin/openzeppelin-contracts/blob/master/contracts/utils/math/SafeMath.sol" target="_blank" rel="noopener noreferrer">OpenZepplin SafeMath<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>库。表达式 -x 相当于)T(0)- x)这里 T 是指 x 的类型。 -x 只能应用在有符号型的整数上。 如果 x 为负数， -x 为正数。 由于使用两进制补码表示数据，你还需要小心:如果有 <code>int x = type(int).min;</code>， 那 -x 将不在正数取值的范围内。 这意味着这个检测 <code>unchecked { assert(-x == x); }</code> 是可以通过的(即这种情况下，不能假设它的负数会是正数)，如果是 checked 模式，则会触发异常。</td></tr> <tr><td>除法运算</td> <td>除法运算结果的类型始终是其中一个操作数的类型，整数除法总是产生整数。 在Solidity中，分数会取零。 这意味着 <code>int256(-5)/ int256(2)== int256(-2)</code>。</td> <td>注意在智能合约中，在 字面常量 上进行除法会保留精度(保留小数位)。除以0 会发生 Panic 错误 ， 而且这个检查，不可以通过 <code>unchecked { ... }</code> 禁用掉。表达式 <code>type(int).min /)-1)</code> 是仅有的整除会发生向上溢出的情况。 在算术检查模式下，这会触发一个失败异常，在截断模式下，表达式的值将是 <code>type(int).min</code> 。</td></tr> <tr><td>模运算(取余)</td> <td>模运算 a％n 是在操作数 a 的除以 n 之后产生余数 r ，其中 <code>q = int(a / n)和 r = a -)n * q)</code> 。 这意味着模运算结果与左操作数相同的符号相同(或零)。 对于 负数的<code>a : a % n == -(-a % n)</code>， 几个例子：<div><code>int256(5)% int256(2)== int256(1)</code></div><div><code>int256(5)% int256(-2)== int256(1)</code></div><div><code>int256(-5)% int256(2)== int256(-1)</code></div><div><code>int256(-5)% int256(-2)== int256(-1)</code></div></td> <td>对0取模会发生错误 Panic 错误，该检查不能通过<code>unchecked { … }</code> 。</td></tr> <tr><td>幂运算</td> <td>幂运算仅适用于无符号类型。 结果的类型总是等于基数的类型. 请注意类型足够大以能够容纳幂运算的结果，要么发生潜在的assert异常或者使用截断模式。</td> <td>在“checked” 模式下，幂运算仅会为小基数使用相对便宜的 exp 操作码。 例如 x ** 3 的例子，表达式 x * x * x 也许更便宜。 在任何情况下，都建议进行 gas 消耗测试和使用优化器。注意 0 ** 0 在EVM中定义为 1 。</td></tr></tbody></table> <h3 id="_3-定长浮点型"><a href="#_3-定长浮点型" class="header-anchor">#</a> 3.定长浮点型</h3> <div class="custom-block warning"><p class="title">注解</p><p>Solidity 还没有完全支持定长浮点型。可以声明定长浮点型的变量，但不能给它们赋值或把它们赋值给其他变量。。</p></div><p>fixed / ufixed：表示各种大小的有符号和无符号的定长浮点型。 在关键字 ufixedMxN 和 fixedMxN 中，M 表示该类型占用的位数，N 表示可用的小数位数。 M 必须能整除 8，即 8 到 256 位。 N 则可以是从 0 到 80 之间的任意数。 ufixed 和 fixed 分别是 ufixed128x19 和 fixed128x19 的别名。</p> <p>运算符：</p> <ul><li>比较运算符：&lt;=， &lt;， ==， !=， &gt;=， &gt;)返回值是布尔型)</li> <li>算术运算符：+， -， 一元运算 -， 一元运算 +， *， /， %)取余数)</li></ul> <blockquote><p>浮点型(在许多语言中的 float 和 double 类型，更准确地说是 IEEE 754 类型)和定长浮点型之间最大的不同点是， 在前者中整数部分和小数部分(小数点后的部分)需要的位数是灵活可变的，而后者中这两部分的长度受到严格的规定。 一般来说，在浮点型中，几乎整个空间都用来表示数字，但只有少数的位来表示小数点的位置。</p></blockquote> <h3 id="_4-地址类型"><a href="#_4-地址类型" class="header-anchor">#</a> 4.地址类型</h3> <p>地址类型 Address 有两种形式，他们大致相同：</p> <ul><li>address：保存一个20字节的值(以太坊地址的大小)。</li> <li>address payable ：可支付地址，与 address 相同，不过有成员函数 transfer 和 send 。</li></ul> <blockquote><p>这种区别背后的思想是 address payable 可以接受以太币的地址，而一个普通的 address 则不能。</p></blockquote> <h4 id="类型转换"><a href="#类型转换" class="header-anchor">#</a> 类型转换:</h4> <ul><li>允许从 address payable 到 address 的隐式转换，而从 address 到 address payable 必须显示的转换, 通过 payable(&lt; address &gt;)进行转换。</li> <li>在0.5版本,执行这种转换的唯一方法是使用中间类型，先转换为 <code>uint160</code> 如,  <code>address payable ap = address(uint160(addr))</code>;</li> <li>address 允许和 uint160、 整型字面常量、bytes20 及合约类型相互转换。</li> <li>只能通过 payable(...)表达式把 address 类型和合约类型转换为 address payable。 只有能接收以太币的合约类型，才能够进行此转换。例如合约要么有 receive 或可支付的回退函数。 注意 payable(0)是有效的，这是此规则的例外。</li></ul> <blockquote><p>如果你需要 address 类型的变量，并计划发送以太币给这个地址，那么声明类型为 address payable 可以明确表达出你的需求。 同样，尽量更早对他们进行区分或转换。</p></blockquote> <h4 id="运算符"><a href="#运算符" class="header-anchor">#</a> 运算符:</h4> <p>&lt;=, &lt;, ==, !=, &gt;= and &gt;</p> <div class="custom-block warning"><p class="title">注解</p><p>如果将使用较大字节数组类型转换为 address ，例如 bytes32 ，那么 address 将被截断。 为了减少转换歧义，0.4.24及更高编译器版本要求我们在转换中显式截断处理。 以32bytes值 0x111122223333444455556666777788889999AAAABBBBCCCCDDDDEEEEFFFFCCCC 为例， 如果使用 <code>address(uint160(bytes20(b)))</code> 结果是 0x111122223333444455556666777788889999aAaa， 而使用 <code>address(uint160(uint256(b)))</code> 结果是 0x777788889999AaAAbBbbCcccddDdeeeEfFFfCcCc 。</p></div><blockquote><p>address 和 address payable 的区别是在 0.5.0 版本引入的，同样从这个版本开始，合约类型不再继承自地址类型，不过如果合约有可支付的回退( payable fallback )函数或receive 函数，合约类型仍然可以显示转换为 address 或 address payable 。</p></blockquote> <h4 id="地址类型成员变量"><a href="#地址类型成员变量" class="header-anchor">#</a> 地址类型成员变量</h4> <p>查看所有的成员，可参考 <a href="https://learnblockchain.cn/docs/solidity/units-and-global-variables.html#address-related" target="_blank" rel="noopener noreferrer">地址成员<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a>。</p> <h4 id="balance-和-transfer"><a href="#balance-和-transfer" class="header-anchor">#</a> balance 和 transfer</h4> <p>可以使用 balance 属性来查询一个地址的余额， 也可以使用 transfer 函数向一个可支付地址(payable address)发送 以太币Ether)以 wei 为单位)：</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">address</span> x <span class="token operator">=</span> <span class="token number">0x123</span><span class="token punctuation">;</span>
<span class="token builtin">address</span> myAddress <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">;</span>
<span class="token keyword">if</span><span class="token punctuation">)</span>x<span class="token punctuation">.</span>balance <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token operator">&amp;&amp;</span> myAddress<span class="token punctuation">.</span>balance <span class="token operator">&gt;=</span> <span class="token number">10</span><span class="token punctuation">)</span>x<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>如果当前合约的余额不够多，则 transfer 函数会执行失败，或者如果以太转移被接收帐户拒绝， transfer 函数同样会失败而进行回退。</p> <blockquote><p>如果 x 是一个合约地址，它的代码(更具体来说是, 如果有receive函数, 执行 receive 接收以太函数, 或者存在fallback函数,执行 Fallback 回退函数 函数)会跟 transfer 函数调用一起执行(这是 EVM 的一个特性，无法阻止)。 如果在执行过程中用光了 gas 或者因为任何原因执行失败，以太币Ether 交易会被打回，当前的合约也会在终止的同时抛出异常。</p></blockquote> <h4 id="send"><a href="#send" class="header-anchor">#</a> send</h4> <p>send 是 transfer 的低级版本。如果执行失败，当前的合约不会因为异常而终止，但 send 会返回 false。</p> <div class="custom-block warning"><p class="title">注解</p><p>在使用 send 的时候会有些风险：如果调用栈深度是 1024 会导致发送失败(这总是可以被调用者强制)，如果接收者用光了 gas 也会导致发送失败。 所以为了保证 以太币Ether 发送的安全，一定要检查 send 的返回值，使用 transfer 或者更好的办法： 使用接收者自己取回资金的模式。</p></div><h4 id="call、delegatecall-和-staticcall"><a href="#call、delegatecall-和-staticcall" class="header-anchor">#</a> call、delegatecall 和 staticcall</h4> <p>为了与不符合 应用二进制接口Application Binary Interface(ABI)的合约交互，或者要更直接地控制编码，提供了函数 call，delegatecall 和 staticcall 。 它们都带有一个 bytes memory 参数和返回执行成功状态(bool)和数据(bytes memory)。</p> <p>函数 abi.encode，abi.encodePacked，abi.encodeWithSelector 和 abi.encodeWithSignature 可用于编码结构化数据。</p> <p>例如:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">bytes</span> <span class="token keyword">memory</span> payload <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;register(string)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">(</span><span class="token builtin">bool</span> success<span class="token punctuation">,</span> <span class="token builtin">bytes</span> <span class="token keyword">memory</span> returnData<span class="token punctuation">)</span><span class="token operator">=</span> <span class="token builtin">address</span><span class="token punctuation">(</span>nameReg<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span>payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">require</span><span class="token punctuation">(</span>success<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>此外，为了与不符合 应用二进制接口Application Binary Interface(ABI)的合约交互，于是就有了可以接受任意类型任意数量参数的 call 函数。 这些参数会被打包到以 32 字节为单位的连续区域中存放。 其中一个例外是当第一个参数被编码成正好 4 个字节的情况。 在这种情况下，这个参数后边不会填充后续参数编码，以允许使用函数签名。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">address</span> nameReg <span class="token operator">=</span> <span class="token number">0x72ba7d8e73fe8eb666ea66babc8116a41bfb10e2</span><span class="token punctuation">;</span>
nameReg<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token string">&quot;register&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
nameReg<span class="token punctuation">.</span><span class="token function">call</span><span class="token punctuation">(</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">&quot;fun(uint256)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><blockquote><p>所有这些函数都是低级函数，应谨慎使用。 具体来说，任何未知的合约都可能是恶意的，我们在调用一个合约的同时就将控制权交给了它，而合约又可以回调合约，所以要准备好在调用返回时改变相应的状态变量(可参考 可重入 )， 与其他合约交互的常规方法是在合约对象上调用函数(x.f())。</p></blockquote> <blockquote><p>0.5.以前版本的 Solidity 允许这些函数接收任意参数，并且还会以不同方式处理 bytes4 类型的第一个参数。 在版本0.5.0中删除了这些边缘情况。</p></blockquote> <p>可以使用 gas 修改器modifier 调整提供的 gas 数量</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">address</span><span class="token punctuation">(</span>nameReg<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>gas<span class="token punctuation">:</span> <span class="token number">1000000</span><span class="token punctuation">}</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;register(string)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>类似地，也能控制提供的 以太币Ether 的值</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">address</span><span class="token punctuation">(</span>nameReg<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>value<span class="token punctuation">:</span> <span class="token number">1</span> ether<span class="token punctuation">}</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;register(string)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>最后一点，这些 修改器modifier 可以联合使用。每个修改器出现的顺序不重要</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">address</span><span class="token punctuation">(</span>nameReg<span class="token punctuation">)</span><span class="token punctuation">.</span>call<span class="token punctuation">{</span>gas<span class="token punctuation">:</span> <span class="token number">1000000</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">1</span> ether<span class="token punctuation">}</span><span class="token punctuation">(</span>abi<span class="token punctuation">.</span><span class="token function">encodeWithSignature</span><span class="token punctuation">(</span><span class="token string">&quot;register(string)&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;MyName&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>以类似的方式，可以使用函数 delegatecall ：区别在于只调用给定地址的代码(函数)，其他状态属性如(存储，余额 …)都来自当前合约。 delegatecall 的目的是使用另一个合约中的库代码。 用户必须确保两个合约中的存储结构都适合委托调用)delegatecall)。</p> <blockquote><p>在以太坊家园(homestead) 之前，只有 callcode 函数，它无法访问原始的 msg.sender 和 msg.value 值。 此函数已在0.5.0版中删除。</p></blockquote> <p>从以太坊拜占庭(byzantium)版本开始 提供了 staticcall ，它与 call 基本相同，但如果被调用的函数以任何方式修改状态变量，都将回退。</p> <p>所有三个函数 call ，delegatecall 和 staticcall 都是非常低级的函数，应该只把它们当作 最后一招 来使用，因为它们破坏了 Solidity 的类型安全性。</p> <p>所有三种方法都提供 gas 选项，而 delegatecall 不支持 value 选项。</p> <blockquote><p>不管是读取状态还是写入状态，最好避免在合约代码中硬编码使用的 gas 值。这可能会引入”陷阱“，而且 gas 的消耗也是可能会改变的。</p></blockquote> <blockquote><p>所有合约都可以转换为 address 类型，因此可以使用 address(this).balance 查询当前合约的余额。</p></blockquote> <h3 id="_5-合约类型"><a href="#_5-合约类型" class="header-anchor">#</a> 5.合约类型</h3> <p>每一个 contract 定义都有他自己的类型。</p> <p>您可以隐式地将合约转换为从他们继承的合约。 合约可以显式转换为 address 类型。</p> <p>只有当合约具有接收receive函数或payable回退函数时，才能显式和 address payable 类型相互转换 转换仍然使用 address(x) 执行，如果合约类型没有接收或payable 回退功能，则可以使用 payable(address(x))转换为 address payable 。</p> <p>可以参考 地址类型.</p> <p>注解</p> <p>在版本0.5.0之前，合约直接从地址类型派生的， 并且 address 和 address payable 之间没有区别。</p> <p>如果声明一个合约类型的局部变量( MyContract c )，则可以调用该合约的函数。 注意需要赋相同合约类型的值给它。</p> <p>您还可以实例化合约(即新创建一个合约对象)，参考 ‘使用new创建合约’。</p> <p>合约和 address 的数据表示是相同的， 参考 ABI。</p> <p>合约不支持任何运算符。</p> <p>合约类型的成员是合约的外部函数及 public 的 状态变量。</p> <p>对于合约 C 可以使用 type(C)获取合约的类型信息，参考 类型信息 。</p> <p>定长字节数组
关键字有：bytes1， bytes2， bytes3， …， bytes32。</p> <p>运算符：</p> <p>比较运算符：&lt;=， &lt;， ==， !=， &gt;=， &gt;)返回布尔型)
位运算符： &amp;， |， ^)按位异或)， ~)按位取反)
移位运算符： &lt;&lt;)左移位)， &gt;&gt;)右移位)
索引访问：如果 x 是 bytesI 类型，那么 x[k])其中 0 &lt;= k &lt; I)返回第 k 个字节(只读)。
该类型可以和作为右操作数的无符号整数类型进行移位运算(但返回结果的类型和左操作数类型相同)，右操作数表示需要移动的位数。 进行有符号整数位移运算会引发运行时异常。</p> <p>成员变量：</p> <p>.length 表示这个字节数组的长度(只读).
注解</p> <p>可以将 byte[] 当作字节数组使用，但这种方式非常浪费存储空间，准确来说，是在传入调用时，每个元素会浪费 31 字节。 更好地做法是使用 bytes。</p> <p>注解</p> <p>在 0.8.0 之前, byte 用作为 bytes1 的别名。</p> <p>变长字节数组
bytes:
变长字节数组，参见 数组。它并不是值类型。
string:
变长 UTF-8 编码字符串类型，参见 数组。并不是值类型。
地址字面常量
比如像 0xdCad3a6d3569DF655070DEd06cb7A1b2Ccd1D3AF 这样的通过了地址校验和测试的十六进制字面常量会作为 address 类型。 而没有通过校验测试, 长度在 39 到 41 个数字之间的十六进制字面常量，会产生一个错误,您可以在零前面添加(对于整数类型)或在零后面添加(对于bytesNN类型)以消除错误。</p> <p>注解</p> <p>混合大小写的地址校验和格式定义在 EIP-55 中。</p> <p>有理数和整数字面常量
整数字面常量由范围在 0-9 的一串数字组成，表现成十进制。 例如，69 表示数字 69。 Solidity 中是没有八进制的，因此前置 0 是无效的。</p> <p>十进制小数字面常量带有一个 .，至少在其一边会有一个数字。 比如：1.，.1，和 1.3。</p> <p>科学符号也是支持的，尽管指数必须是整数，但底数可以是小数。 比如：2e10， -2e10， 2e-10， 2.5e1。</p> <p>为了提高可读性可以在数字之间加上下划线。 例如，十进制<code>123_000</code>，十六进制 0x2eff_abde，科学十进制表示1_2e345_678都是有效的。 下划线仅允许在两位数之间，并且不允许下划线连续出现。添加到数字文字中下划线没有额外的语义，下划线会被编译器忽略。</p> <p>数值字面常量表达式本身支持任意精度，除非它们被转换成了非字面常量类型(也就是说，当它们出现在变量表达式中时就会发生转换)。 这意味着在数值常量表达式中, 计算不会溢出而除法也不会截断。</p> <p>例如，)2<strong>800 + 1)- 2</strong>800 的结果是字面常量 1)属于 uint8 类型)，尽管计算的中间结果已经超过了 以太坊虚拟机Ethereum Virtual Machine(EVM)的机器字长度。 此外， .5 * 8 的结果是整型 4)尽管有非整型参与了计算)。</p> <p>只要操作数是整型，任意整型支持的运算符都可以被运用在数值字面常量表达式中。 如果两个中的任一个数是小数，则不允许进行位运算。如果指数是小数的话，也不支持幂运算(因为这样可能会得到一个无理数)。</p> <p>常量作为左(或基)操作数和整数类型的移位和幂运算时总是执行正确的(指数)操作，不管右(指数)操作数的类型如何。</p> <p>注解</p> <p>Solidity 对每个有理数都有对应的数值字面常量类型。 整数字面常量和有理数字面常量都属于数值字面常量类型。 除此之外，所有的数值字面常量表达式(即只包含数值字面常量和运算符的表达式)都属于数值字面常量类型。 因此数值字面常量表达式 1 + 2 和 2 + 1 的结果跟有理数三的数值字面常量类型相同。</p> <p>注解</p> <p>在早期版本中(0.4.0之前)，整数字面常量的除法也会截断，但在现在的版本中，会将结果转换成一个有理数。即 5 / 2 并不等于 2，而是等于 2.5。</p> <p>注解</p> <p>数值字面常量表达式只要在非字面常量表达式中使用就会转换成非字面常量类型。 在下面的例子中，尽管我们知道 b 的值是一个整数，但 2.5 + a 这部分表达式并不进行类型检查，因此编译不能通过。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">uint128</span> a <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
<span class="token builtin">uint128</span> b <span class="token operator">=</span> <span class="token number">2.5</span> <span class="token operator">+</span> a <span class="token operator">+</span> <span class="token number">0.5</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>字符串字面常量及类型
字符串字面常量是指由双引号或单引号引起来的字符串(&quot;foo&quot; 或者 'bar')。 它们也可以分为多个连续的部分(&quot;foo&quot; &quot;bar&quot; 等效于<code>”foobar”)，这在处理长字符串时很有用。 不像在 C 语言中那样带有结束符；”foo”</code> 相当于 3 个字节而不是 4 个。 和整数字面常量一样，字符串字面常量的类型也可以发生改变，</p> <p>但它们可以隐式地转换成 bytes1，……，bytes32，如果合适的话，还可以转换成 bytes 以及 string。</p> <p>例如： bytes32 samevar = &quot;stringliteral&quot; 字符串字面常量在赋值给 bytes32 时被解释为原始的字节形式。</p> <p>字符串字面常量只能包含可打印的ASCII字符，这意味着他是介于0x1F和0x7E之间的字符。</p> <p>此外，字符串字面常量支持下面的转义字符：</p> <p>&lt; newline&gt;)转义实际换行)
\)反斜杠)
')单引号)
&quot;)双引号)
\b)退格)
\f)换页)
\n)换行符)
\r)回车)
\t)标签 tab)
\v)垂直标签)
\xNN)十六进制转义，见下文)
\uNNNN)unicode 转义，见下文)
\xNN 表示一个 16 进制值，最终转换成合适的字节，而 \uNNNN 表示 Unicode 编码值，最终会转换为 UTF-8 的序列。</p> <p>以下示例中的字符串长度为十个字节，它以换行符开头，后跟双引号，单引号，反斜杠字符，以及(没有分隔符)字符序列 abcdef 。</p> <p>&quot;\n&quot;'\abc<br>
def&quot;
任何unicode行终结符(即LF，VF，FF，CR，NEL，LS，PS)都不会被当成字符串字面常量的终止符。 如果前面没有前置 \，则换行符仅终止字符串字面常量。</p> <p>Unicode 字面常量
常规字符串文字只能包含ASCII，而Unicode文字(以关键字unicode为前缀)可以包含任何有效的UTF-8序列。 它们还支持与转义序列完全相同的字符作为常规字符串文字。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">string</span> <span class="token keyword">memory</span> a <span class="token operator">=</span> unicode<span class="token string">&quot;Hello 😃&quot;</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>十六进制字面常量
十六进制字面常量以关键字 hex 打头，后面紧跟着用单引号或双引号引起来的字符串(例如，hex&quot;001122FF&quot; )。 字符串的内容必须是一个十六进制的字符串，它们的值将使用二进制表示。</p> <p>它们的内容必须是十六进制数字，可以选择使用单个下划线作为字节边界分隔符。 字面常量的值将是十六进制序列的二进制表示形式。</p> <p>用空格分隔的多个十六进制字面常量被合并为一个字面常量： hex&quot;00112233&quot; hex&quot;44556677&quot; 等同于 hex&quot;0011223344556677&quot;</p> <p>十六进制字面常量跟 字符串字面常量 很类似，具有相同的转换规则</p> <p>枚举类型
枚举是在Solidity中创建用户定义类型的一种方法。 它们是显示所有整型相互转换，但不允许隐式转换。 从整型显式转换枚举，会在运行时检查整数时候在枚举范围内，否则会导致异常( Panic异常 )。 枚举需要至少一个成员,默认值是第一个成员，枚举不能多于 256 个成员。</p> <p>数据表示与C中的枚举相同：选项从“0”开始的无符号整数值表示。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.16</span>  <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">test</span> <span class="token punctuation">{</span>
    <span class="token keyword">enum</span> <span class="token class-name">ActionChoices</span> <span class="token punctuation">{</span> GoLeft<span class="token punctuation">,</span> GoRight<span class="token punctuation">,</span> GoStraight<span class="token punctuation">,</span> SitStill <span class="token punctuation">}</span>
    ActionChoices choice<span class="token punctuation">;</span>
    ActionChoices <span class="token keyword">constant</span> defaultChoice <span class="token operator">=</span> ActionChoices<span class="token punctuation">.</span>GoStraight<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">setGoStraight</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        choice <span class="token operator">=</span> ActionChoices<span class="token punctuation">.</span>GoStraight<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// 由于枚举类型不属于 |ABI| 的一部分，因此对于所有来自 Solidity 外部的调用，</span>
    <span class="token comment">// &quot;getChoice&quot; 的签名会自动被改成 &quot;getChoice()returns)uint8)&quot;。</span>

    <span class="token keyword">function</span> <span class="token function">getChoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span>ActionChoices<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> choice<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">getDefaultChoice</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token builtin">uint</span><span class="token punctuation">(</span>defaultChoice<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br></div></div><div class="language- extra-class"><pre><code> 枚举还可以在合约或库定义之外的文件级别上声明。
</code></pre></div><p>函数类型
函数类型是一种表示函数的类型。可以将一个函数赋值给另一个函数类型的变量，也可以将一个函数作为参数进行传递，还能在函数调用中返回函数类型变量。 函数类型有两类：</p> <p>内部(internal) 函数类型
外部(external) 函数类型
内部函数只能在当前合约内被调用(更具体来说，在当前代码块内，包括内部库函数和继承的函数中)，因为它们不能在当前合约上下文的外部被执行。 调用一个内部函数是通过跳转到它的入口标签来实现的，就像在当前合约的内部调用一个函数。</p> <p>外部函数由一个地址和一个函数签名组成，可以通过外部函数调用传递或者返回。</p> <p>函数类型表示成如下的形式</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">function</span><span class="token punctuation">)</span><span class="token operator">&lt;</span>parameter types<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">{</span><span class="token keyword">internal</span><span class="token operator">|</span><span class="token keyword">external</span><span class="token punctuation">}</span> <span class="token punctuation">[</span><span class="token keyword">pure</span><span class="token operator">|</span><span class="token keyword">constant</span><span class="token operator">|</span><span class="token keyword">view</span><span class="token operator">|</span><span class="token keyword">payable</span><span class="token punctuation">]</span> <span class="token punctuation">[</span><span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token operator">&lt;</span><span class="token keyword">return</span> types<span class="token operator">&gt;</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>与参数类型相反，返回类型不能为空 —— 如果函数类型不需要返回，则需要删除整个 returns)&lt; return types &gt;)部分。</p> <p>函数类型默认是内部函数，因此不需要声明 internal 关键字。
请注意，这仅适用于函数类型，合约中定义的函数明确指定可见性，它们没有默认值。
类型转换：</p> <p>函数类型 A 可以隐式转换为函数类型 B 当且仅当: 它们的参数类型相同，返回类型相同，它们的内部/外部属性是相同的，并且 A 的状态可变性并不比 B 的状态可变性更具限制性，比如：</p> <p>pure 函数可以转换为 view 和 non-payable 函数
view 函数可以转换为 non-payable 函数
payable 函数可以转换为 non-payable 函数
其他的转换则不可以。</p> <p>关于 payable 和 non-payable 的规则可能有点令人困惑，但实质上，如果一个函数是 payable ，这意味着它 也接受零以太的支付，因此它也是 non-payable 。 另一方面，non-payable 函数将拒绝发送给它的 以太币Ether ， 所以 non-payable 函数不能转换为 payable 函数。</p> <p>如果当函数类型的变量还没有初始化时就调用它的话会引发一个 Panic 异常。 如果在一个函数被 delete 之后调用它也会发生相同的情况。</p> <p>如果外部函数类型在 Solidity 的上下文环境以外的地方使用，它们会被视为 function 类型。 该类型将函数地址紧跟其函数标识一起编码为一个 bytes24 类型。。</p> <p>请注意，当前合约的 public 函数既可以被当作内部函数也可以被当作外部函数使用。 如果想将一个函数当作内部函数使用，就用 f 调用，如果想将其当作外部函数，使用 this.f 。</p> <p>成员方法：</p> <p>public(或 external)函数都有下面的成员：</p> <p>.address 返回函数的合约地址。
.selector 返回 ABI 函数选择器
注解</p> <p>public(或 external)函数过去有额外两个成员：.gas(uint)和 .value(uint)在0.6.2中弃用了，在 0.8.0 中移除了。 用 {gas: ...} 和 {value: ...} 代替， 参考 外部函数调用 了解更多。</p> <p>下面的例子，显示如何使用成员:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.4</span>  <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Example</span> <span class="token punctuation">{</span>
  <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bytes4</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">assert</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>f<span class="token punctuation">.</span><span class="token builtin">address</span> <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token keyword">this</span><span class="token punctuation">.</span>f<span class="token punctuation">.</span>selector<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>f<span class="token punctuation">{</span>gas<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">,</span> value<span class="token punctuation">:</span> <span class="token number">800</span><span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br></div></div><p>如果使用内部函数类型的例子:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.16</span>  <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">library</span> <span class="token class-name">ArrayUtils</span> <span class="token punctuation">{</span>
  <span class="token comment">// 内部函数可以在内部库函数中使用，</span>
  <span class="token comment">// 因为它们会成为同一代码上下文的一部分</span>
  <span class="token keyword">function</span> <span class="token function">map</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> self<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span>f<span class="token punctuation">)</span>
    <span class="token keyword">internal</span>
    <span class="token keyword">pure</span>
    <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> r<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>self<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">)</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      r<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>self<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">reduce</span><span class="token punctuation">(</span>
    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> self<span class="token punctuation">,</span>
    <span class="token keyword">function</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">,</span> <span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span>f
  <span class="token punctuation">)</span>
    <span class="token keyword">internal</span>
    <span class="token keyword">pure</span>
    <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> r<span class="token punctuation">)</span>
  <span class="token punctuation">{</span>
    r <span class="token operator">=</span> self<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">)</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      r <span class="token operator">=</span> <span class="token function">f</span><span class="token punctuation">(</span>r<span class="token punctuation">,</span> self<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">range</span><span class="token punctuation">(</span><span class="token builtin">uint</span> length<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> r<span class="token punctuation">)</span><span class="token punctuation">{</span>
    r <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>length<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span><span class="token punctuation">)</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> r<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
      r<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> i<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">Pyramid</span> <span class="token punctuation">{</span>
  <span class="token keyword">using</span> <span class="token class-name">ArrayUtils</span> <span class="token keyword">for</span> <span class="token operator">*</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">pyramid</span><span class="token punctuation">(</span><span class="token builtin">uint</span> l<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> ArrayUtils<span class="token punctuation">.</span><span class="token function">range</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span>square<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">reduce</span><span class="token punctuation">(</span>sum<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">square</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">*</span> x<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token builtin">uint</span> x<span class="token punctuation">,</span> <span class="token builtin">uint</span> y<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br></div></div><p>另外一个使用外部函数类型的例子:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.22</span>  <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Oracle</span> <span class="token punctuation">{</span>
  <span class="token keyword">struct</span> <span class="token class-name">Request</span> <span class="token punctuation">{</span>
    <span class="token builtin">bytes</span> data<span class="token punctuation">;</span>
    <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token keyword">external</span> callback<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  Request<span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">private</span> requests<span class="token punctuation">;</span>
  <span class="token keyword">event</span> <span class="token function">NewRequest</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">query</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">,</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token keyword">external</span> callback<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
    requests<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token function">Request</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> callback<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">emit</span> <span class="token function">NewRequest</span><span class="token punctuation">(</span>requests<span class="token punctuation">.</span>length <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">reply</span><span class="token punctuation">(</span><span class="token builtin">uint</span> requestID<span class="token punctuation">,</span> <span class="token builtin">uint</span> response<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
    <span class="token comment">// 这里检查回复来自可信来源</span>
    requests<span class="token punctuation">[</span>requestID<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">callback</span><span class="token punctuation">(</span>response<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">OracleUser</span> <span class="token punctuation">{</span>
  Oracle <span class="token keyword">constant</span> <span class="token keyword">private</span> ORACLE_CONST <span class="token operator">=</span> <span class="token function">Oracle</span><span class="token punctuation">(</span><span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0x00000000219ab540356cBB839Cbe05303d7705Fa</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// known contract</span>
  <span class="token builtin">uint</span> <span class="token keyword">private</span> exchangeRate<span class="token punctuation">;</span>
  <span class="token keyword">function</span> <span class="token function">buySomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
    ORACLE_CONST<span class="token punctuation">.</span><span class="token function">query</span><span class="token punctuation">(</span><span class="token string">&quot;USD&quot;</span><span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>oracleResponse<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">function</span> <span class="token function">oracleResponse</span><span class="token punctuation">(</span><span class="token builtin">uint</span> response<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
    <span class="token keyword">require</span><span class="token punctuation">(</span>
        msg<span class="token punctuation">.</span>sender <span class="token operator">==</span> <span class="token builtin">address</span><span class="token punctuation">(</span>ORACLE_CONST<span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token string">&quot;Only oracle can call this.&quot;</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    exchangeRate <span class="token operator">=</span> response<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br></div></div><p>注解</p> <p>Lambda 表达式或者内联函数的引入在计划内，但目前还没支持。</p> <p>引用类型
引用类型可以通过多个不同的名称修改它的值，而值类型的变量，每次都有独立的副本。因此，必须比值类型更谨慎地处理引用类型。 目前，引用类型包括结构，数组和映射，如果使用引用类型，则必须明确指明数据存储哪种类型的位置(空间)里：</p> <p>内存memory 即数据在内存中，因此数据仅在其生命周期内(函数调用期间)有效。不能用于外部调用。
存储storage 状态变量保存的位置，只要合约存在就一直存储．
调用数据calldata 用来保存函数参数的特殊数据位置，是一个只读位置。
注解</p> <p>译者注：0.6.9 之前 calldata 仅用于外部函数调用参数，0.6.9之后可用于任意函数。</p> <p>更改数据位置或类型转换将始终产生自动进行一份拷贝，而在同一数据位置内(对于 存储storage 来说)的复制仅在某些情况下进行拷贝。</p> <p>数据位置
所有的引用类型，如 数组 和 结构体 类型，都有一个额外注解 数据位置 ，来说明数据存储位置。 有三种位置： 内存memory 、 存储storage 以及 调用数据calldata 。调用数据calldata 是不可修改的、非持久的函数参数存储区域，效果大多类似 内存memory 。</p> <p>调用数据calldata 是外部函数的参数所必需指定的位置，但也可以用于其他变量。</p> <p>注解</p> <p>在版本0.5.0之前，数据位置可以省略，并且根据变量的类型，函数类型等有默认数据位置，但是所有复杂类型现在必须提供明确的数据位置。</p> <p>注解</p> <p>如果可以的话，请尽量使用 calldata 作为数据位置，因为它将避免复制，并确保不能修改数据。 函数的返回值中也可以使用 calldata 数据位置的数组和结构，但是无法给其分配空间。</p> <p>数据位置与赋值行为
数据位置不仅仅表示数据如何保存，它同样影响着赋值行为：</p> <p>在 存储storage 和 内存memory 之间两两赋值(或者从 调用数据calldata 赋值 )，都会创建一份独立的拷贝。
从 内存memory 到 内存memory 的赋值只创建引用， 这意味着更改内存变量，其他引用相同数据的所有其他内存变量的值也会跟着改变。
从 存储storage 到本地存储变量的赋值也只分配一个引用。
其他的向 存储storage 的赋值，总是进行拷贝。 这种情况的示例如对状态变量或 存储storage 的结构体类型的局部变量成员的赋值，即使局部变量本身是一个引用，也会进行一份拷贝(译者注：查看下面 ArrayContract 合约 更容易理解)。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.5.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Tiny</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x<span class="token punctuation">;</span> <span class="token comment">// x 的数据存储位置是 storage，　位置可以忽略</span>

    <span class="token comment">// memoryArray 的数据存储位置是 memory</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> memoryArray<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        x <span class="token operator">=</span> memoryArray<span class="token punctuation">;</span> <span class="token comment">// 将整个数组拷贝到 storage 中，可行</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> y <span class="token operator">=</span> x<span class="token punctuation">;</span>  <span class="token comment">// 分配一个指针(其中 y 的数据存储位置是 storage)，可行</span>
        y<span class="token punctuation">[</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment">// 返回第 8 个元素，可行</span>
        y<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 通过 y 修改 x，可行</span>
        <span class="token keyword">delete</span> x<span class="token punctuation">;</span> <span class="token comment">// 清除数组，同时修改 y，可行</span>

        <span class="token comment">// 下面的就不可行了；需要在 storage 中创建新的未命名的临时数组，</span>
        <span class="token comment">// 但 storage 是“静态”分配的：</span>
        <span class="token comment">// y = memoryArray;</span>
        <span class="token comment">// 下面这一行也不可行，因为这会“重置”指针，</span>
        <span class="token comment">// 但并没有可以让它指向的合适的存储位置。</span>
        <span class="token comment">// delete y;</span>

        <span class="token function">g</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 g 函数，同时移交对 x 的引用</span>
        <span class="token function">h</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 调用 h 函数，同时在 memory 中创建一个独立的临时拷贝</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> <span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">pure</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">h</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>数组
数组可以在声明时指定长度，也可以动态调整大小(长度)。</p> <p>一个元素类型为 T，固定长度为 k 的数组可以声明为 T[k]，而动态数组声明为 T[]。 举个例子，一个长度为 5，元素类型为 uint 的动态数组的数组(二维数组)，应声明为 uint[][5])注意这里跟其它语言比，数组长度的声明位置是反的)。</p> <p>注解</p> <p>译者注：作为对比，如在Java中，声明一个包含5个元素、每个元素都是数组的方式为 int[5][]。</p> <p>在Solidity中， X[3] 总是一个包含三个 X 类型元素的数组，即使 X 本身就是一个数组，这和其他语言也有所不同，比如 C 语言。</p> <p>数组下标是从 0 开始的，且访问数组时的下标顺序与声明时相反。</p> <p>如：如果有一个变量为 uint[][5] memory x， 要访问第三个动态数组的第二个元素，使用 x[2][1]，要访问第三个动态数组使用 x[2]。 同样，如果有一个 T 类型的数组 T[5] a ， T 也可以是一个数组，那么 a[2] 总会是 T 类型。</p> <p>数组元素可以是任何类型，包括映射或结构体。对类型的限制是映射只能存储在 存储storage 中，并且公开访问函数的参数需要是 ABI 类型。</p> <p>状态变量标记 public 的数组，Solidity创建一个 getter函数 。 小标数字索引就是 getter函数 的参数。</p> <p>访问超出数组长度的元素会导致异常(assert 类型异常 )。 可以使用 .push()方法在末尾追加一个新元素，其中 .push()追加一个零初始化的元素并返回对它的引用。</p> <p>bytes 和 strings 也是数组
bytes 和 string 类型的变量是特殊的数组。 bytes 类似于 byte[]，但它在 调用数据calldata 和 内存memory 中会被“紧打包”(译者注：将元素连续地存在一起，不会按每 32 字节一单元的方式来存放)。 string 与 bytes 相同，但不允许用长度或索引来访问。</p> <p>Solidity没有字符串操作函数，但是可以使用第三方字符串库，我们可以比较两个字符串通过计算他们的 keccak256-hash ，可使用 keccak256(abi.encodePacked(s1))== keccak256(abi.encodePacked(s2))或者使用 abi.encodePacked(s1, s2)来拼接字符串。</p> <p>我们更多时候应该使用 bytes 而不是 byte[] ，因为Gas 费用更低, byte[] 会在元素之间添加31个填充字节。作为一个基本规则， 对任意长度的原始字节数据使用 bytes，对任意长度字符串(UTF-8)数据使用 string。</p> <p>如果使用一个长度限制的字节数组，应该使用一个 bytes1 到 bytes32 的具体类型，因为它们便宜得多。</p> <p>注解</p> <p>如果想要访问以字节表示的字符串 s，请使用 bytes(s).length / bytes(s)[7] = 'x';。 注意这时你访问的是 UTF-8 形式的低级 bytes 类型，而不是单个的字符。</p> <p>创建内存数组
可使用 new 关键字在 内存memory 中基于运行时创建动态长度数组。 与 存储storage 数组相反的是，你 不能 通过修改成员变量 .push 改变 内存memory 数组的大小。</p> <p>必须提前计算所需的大小或者创建一个新的内存数组并复制每个元素。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.16</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">TX</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token builtin">uint</span> len<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> a <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bytes</span><span class="token punctuation">(</span>len<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">assert</span><span class="token punctuation">(</span>a<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">assert</span><span class="token punctuation">(</span>b<span class="token punctuation">.</span>length <span class="token operator">==</span> len<span class="token punctuation">)</span><span class="token punctuation">;</span>

        a<span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">8</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br></div></div><p>数组字面常量 / 内联数组
数组字面常量是在方括号中( [...] ) 包含一个或多个逗号分隔的表达式。 例如 [1, a, f(3)] 。 必须有一个所有元素都可以隐式转换到普通的类型，这个类型就是数组的基本类型。 数组字面常量总是静态固定大小的 内存memory 数组。</p> <p>在下面的例子中，[1, 2, 3] 的类型是 uint8[3] memory。 因为每个常量的类型都是 uint8 ，如果你希望结果是 uint [3] memory 类型，你需要将第一个元素转换为 uint 。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">^</span><span class="token version number">0.4.16</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">LBC</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token punctuation">{</span>
        <span class="token function">g</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token builtin">uint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">function</span> <span class="token function">g</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> _data<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><p>目前需要注意的是，定长的 内存memory 数组并不能赋值给变长的 内存memory 数组，下面的例子是无法运行的：</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// 这段代码并不能编译。</span>

<span class="token keyword">pragma</span> <span class="token keyword">solidity</span>  <span class="token operator">&gt;=</span><span class="token version number">0.4.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">LBC</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这一行引发了一个类型错误，因为 unint[3] memory</span>
        <span class="token comment">// 不能转换成 uint[] memory。</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> x <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">uint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>计划在未来移除这样的限制，但目前数组在 ABI 中传递的问题造成了一些麻烦。</p> <p>如果要初始化动态长度的数组，则必须显示给各个元素赋值:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">C</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> x <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        x<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
        x<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">;</span>
        x<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">4</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><p>数组成员
length:
数组有 length 成员变量表示当前数组的长度。 一经创建，内存memory 数组的大小就是固定的(但却是动态的，也就是说，它可以根据运行时的参数创建)。
push():
动态的 存储storage 数组以及 bytes 类型( string 类型不可以)都有一个 push()的成员函数，它用来添加新的零初始化元素到数组末尾，并返回元素引用． 因此可以这样：　 x.push().t = 2 或 x.push()= b.
push(x):
动态的 存储storage 数组以及 bytes 类型( string 类型不可以)都有一个 push(ｘ)的成员函数，用来在数组末尾添加一个给定的元素，这个函数没有返回值．
pop:
变长的 存储storage 数组以及 bytes 类型( string 类型不可以)都有一个 pop 的成员函数， 它用来从数组末尾删除元素。 同样的会在移除的元素上隐含调用 delete 。
注解</p> <p>通过 push()　增加 存储storage 数组的长度具有固定的 gas 消耗，因为 存储storage 总是被零初始化，而通过　pop　减少长度则依赖移除与元素的大小(size)．　如果元素是数组,则成本是很高的,因为它包括已删除的元素的清理，类似于在这些元素上调用 delete 。</p> <p>注解</p> <p>如果需要在外部(external)函数中使用多维数组，这需要启用ABI coder v2。 公有(public)函数中是支持的使用多维数组。</p> <p>注解</p> <p>在Byzantium(在2017-10-16日4370000区块上进行硬分叉升级)之前的EVM版本中，无法访问从函数调用返回动态数组。 如果要调用返回动态数组的函数，请确保 EVM 在拜占庭模式上运行。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">ArrayContract</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token operator">**</span><span class="token number">20</span><span class="token punctuation">]</span> m_aLotOfIntegers<span class="token punctuation">;</span>

    <span class="token comment">// 注意下面的代码并不是一对动态数组，</span>
    <span class="token comment">// 而是一个数组元素为一对变量的动态数组(也就是数组元素为长度为 2 的定长数组的动态数组)。</span>
    <span class="token comment">// 因为  T[] 总是 T 的动态数组, 尽管 T 是数组</span>
    <span class="token comment">// 所有的状态变量的数据位置都是 storage</span>
    <span class="token builtin">bool</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> m_pairsOfFlags<span class="token punctuation">;</span>

    <span class="token comment">// newPairs 存储在 memory 中)仅当它是公有的合约函数)</span>
    <span class="token keyword">function</span> <span class="token function">setAllFlagPairs</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> newPairs<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>

     <span class="token comment">// 向一个 storage 的数组赋值会对 ``newPairs`` 进行拷贝，并替代整个 ``m_pairsOfFlags`` 数组</span>
        m_pairsOfFlags <span class="token operator">=</span> newPairs<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">struct</span> <span class="token class-name">StructType</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> contents<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> moreInfo<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    StructType s<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> c<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token comment">// 保存引用</span>
        StructType <span class="token keyword">storage</span> g <span class="token operator">=</span> s<span class="token punctuation">;</span>

        <span class="token comment">// 同样改变了 ``s.moreInfo``.</span>
        g<span class="token punctuation">.</span>moreInfo <span class="token operator">=</span> <span class="token number">2</span><span class="token punctuation">;</span>

        <span class="token comment">// 进行了拷贝，因为 ``g.contents`` 不是本地变量，而是本地变量的成员</span>
        g<span class="token punctuation">.</span>contents <span class="token operator">=</span> c<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">setFlagPair</span><span class="token punctuation">(</span><span class="token builtin">uint</span> index<span class="token punctuation">,</span> <span class="token builtin">bool</span> flagA<span class="token punctuation">,</span> <span class="token builtin">bool</span> flagB<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token comment">// 访问不存在的索引将引发异常</span>
        m_pairsOfFlags<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> flagA<span class="token punctuation">;</span>
        m_pairsOfFlags<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> flagB<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">changeFlagArraySize</span><span class="token punctuation">(</span><span class="token builtin">uint</span> newSize<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
       <span class="token comment">// 使用 push 和 pop 是更改数组长度的唯一方法</span>

        <span class="token keyword">if</span><span class="token punctuation">)</span>newSize <span class="token operator">&lt;</span> m_pairsOfFlags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">)</span>m_pairsOfFlags<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> newSize<span class="token punctuation">)</span>
                m_pairsOfFlags<span class="token punctuation">.</span><span class="token function">pop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token keyword">if</span><span class="token punctuation">)</span>newSize <span class="token operator">&gt;</span> m_pairsOfFlags<span class="token punctuation">.</span>length<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token keyword">while</span><span class="token punctuation">)</span>m_pairsOfFlags<span class="token punctuation">.</span>length <span class="token operator">&lt;</span> newSize<span class="token punctuation">)</span>
                m_pairsOfFlags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token comment">// 这些完全清除了数组</span>
        <span class="token keyword">delete</span> m_pairsOfFlags<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> m_aLotOfIntegers<span class="token punctuation">;</span>
        <span class="token comment">// 效果相同(和上面)</span>
        m_pairsOfFlags<span class="token punctuation">.</span>length <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bool</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token builtin">bytes</span> m_byteData<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">byteArrays</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span> data<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token comment">// 字节数组(bytes)不一样，它们在没有填充的情况下存储。</span>
        <span class="token comment">// 可以被视为与 uint8 [] 相同</span>
        m_byteData <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">)</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> <span class="token number">7</span><span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            m_byteData<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m_byteData<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0x08</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> m_byteData<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">addFlag</span><span class="token punctuation">(</span><span class="token builtin">bool</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> flag<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        m_pairsOfFlags<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span>flag<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m_pairsOfFlags<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">createMemoryArray</span><span class="token punctuation">(</span><span class="token builtin">uint</span> size<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">pure</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bytes</span> <span class="token keyword">memory</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// 使用`new`创建动态内存数组：</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">memory</span> arrayOfPairs <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">uint</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">(</span>size<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 内联(Inline)数组始终是静态大小的，如果只使用字面常量，则必须至少提供一种类型。</span>
        arrayOfPairs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token builtin">uint</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

        <span class="token comment">// 创建一个动态字节数组：</span>
        <span class="token builtin">bytes</span> <span class="token keyword">memory</span> b <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">bytes</span><span class="token punctuation">(</span><span class="token number">200</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">for</span><span class="token punctuation">)</span><span class="token builtin">uint</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span>
            b<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">byte</span><span class="token punctuation">(</span><span class="token builtin">uint8</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> b<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br></div></div><p>数组切片
数组切片是数组连续部分的视图，用法如：x[start:end] ， start 和 end 是 uint256 类型(或结果为 uint256 的表达式)。 x[start:end] 的第一个元素是 x[start] ， 最后一个元素是 x[end - 1] 。</p> <p>如果 start 比 end 大或者 end 比数组长度还大，将会抛出异常。</p> <p>start 和 end 都可以是可选的： start 默认是 0， 而 end 默认是数组长度。</p> <p>数组切片没有任何成员。 它们可以隐式转换为其“背后”类型的数组，并支持索引访问。 索引访问也是相对于切片的开始位置。 数组切片没有类型名称，这意味着没有变量可以将数组切片作为类型，它们仅存在于中间表达式中。</p> <p>注解</p> <p>目前数组切片，仅可使用于 calldata 数组.</p> <p>数组切片在 ABI解码数据的时候非常有用，如：</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.99</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">Proxy</span> <span class="token punctuation">{</span>
    <span class="token comment">/// 被当前合约管理的 客户端合约地址</span>
    <span class="token builtin">address</span> client<span class="token punctuation">;</span>

    <span class="token keyword">constructor</span><span class="token punctuation">(</span><span class="token builtin">address</span> _client<span class="token punctuation">)</span><span class="token punctuation">{</span>
        client <span class="token operator">=</span> _client<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">/// 在进行参数验证之后，转发到由client实现的 &quot;setOwner(address)&quot;</span>
    <span class="token keyword">function</span> <span class="token function">forward</span><span class="token punctuation">(</span><span class="token builtin">bytes</span> <span class="token keyword">calldata</span> _payload<span class="token punctuation">)</span><span class="token keyword">external</span> <span class="token punctuation">{</span>
      <span class="token comment">// 由于 ABI 解码要求填充的数据(padded data)不能使用</span>
        <span class="token comment">// abi.decode(_payload[:4],)bytes4)).</span>
        <span class="token builtin">bytes4</span> sig <span class="token operator">=</span>
            _payload<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">|</span>
           <span class="token punctuation">)</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span>_payload<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token operator">|</span>
           <span class="token punctuation">)</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span>_payload<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token operator">|</span>
           <span class="token punctuation">)</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span>_payload<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">&gt;&gt;</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token keyword">if</span><span class="token punctuation">)</span>sig <span class="token operator">==</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span><span class="token function">keccak256</span><span class="token punctuation">(</span><span class="token string">&quot;setOwner(address)&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token builtin">address</span> owner <span class="token operator">=</span> abi<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>_payload<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token builtin">address</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token keyword">require</span><span class="token punctuation">(</span>owner <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;Address of owner cannot be zero.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
       <span class="token punctuation">)</span><span class="token builtin">bool</span> status<span class="token punctuation">,</span><span class="token punctuation">)</span><span class="token operator">=</span> client<span class="token punctuation">.</span><span class="token function">delegatecall</span><span class="token punctuation">(</span>_payload<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>status<span class="token punctuation">,</span> <span class="token string">&quot;Forwarded call failed.&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br></div></div><p>结构体
Solidity 支持通过构造结构体的形式定义新的类型，以下是一个结构体使用的示例：</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

  <span class="token comment">// 定义的新类型包含两个属性。</span>
  <span class="token comment">// 在合约外部声明结构体可以使其被多个合约共享。 在这里，这并不是真正需要的。</span>
  <span class="token keyword">struct</span> <span class="token class-name">Funder</span> <span class="token punctuation">{</span>
      <span class="token builtin">address</span> addr<span class="token punctuation">;</span>
      <span class="token builtin">uint</span> amount<span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">contract</span> <span class="token class-name">CrowdFunding</span> <span class="token punctuation">{</span>

    <span class="token comment">// 也可以在合约内部定义结构体，这使得它们仅在此合约和衍生合约中可见。</span>
    <span class="token keyword">struct</span> <span class="token class-name">Campaign</span> <span class="token punctuation">{</span>
        <span class="token builtin">address</span> beneficiary<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> fundingGoal<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> numFunders<span class="token punctuation">;</span>
        <span class="token builtin">uint</span> amount<span class="token punctuation">;</span>
        <span class="token keyword">mapping</span><span class="token punctuation">)</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> Funder<span class="token punctuation">)</span>funders<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token builtin">uint</span> numCampaigns<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span><span class="token punctuation">)</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> Campaign<span class="token punctuation">)</span>campaigns<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">newCampaign</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">payable</span> beneficiary<span class="token punctuation">,</span> <span class="token builtin">uint</span> goal<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> campaignID<span class="token punctuation">)</span><span class="token punctuation">{</span>
        campaignID <span class="token operator">=</span> numCampaigns<span class="token operator">++</span><span class="token punctuation">;</span> <span class="token comment">// campaignID 作为一个变量返回</span>

        <span class="token comment">// 不能使用 &quot;campaigns[campaignID] = Campaign(beneficiary, goal, 0, 0)&quot;</span>
        <span class="token comment">// 因为RHS会创建一个包含映射的内存结构体 &quot;Campaign&quot;</span>
        Campaign <span class="token keyword">storage</span> c <span class="token operator">=</span> campaigns<span class="token punctuation">[</span>campaignID<span class="token punctuation">]</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span>beneficiary <span class="token operator">=</span> beneficiary<span class="token punctuation">;</span>
        c<span class="token punctuation">.</span>fundingGoal <span class="token operator">=</span> goal<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">contribute</span><span class="token punctuation">(</span><span class="token builtin">uint</span> campaignID<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">payable</span> <span class="token punctuation">{</span>
        Campaign <span class="token keyword">storage</span> c <span class="token operator">=</span> campaigns<span class="token punctuation">[</span>campaignID<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment">// 以给定的值初始化，创建一个新的临时 memory 结构体，</span>
        <span class="token comment">// 并将其拷贝到 storage 中。</span>
        <span class="token comment">// 注意你也可以使用 Funder(msg.sender, msg.value)来初始化。</span>
        c<span class="token punctuation">.</span>funders<span class="token punctuation">[</span>c<span class="token punctuation">.</span>numFunders<span class="token operator">++</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">Funder</span><span class="token punctuation">(</span><span class="token punctuation">{</span>addr<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> amount<span class="token punctuation">:</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span>amount <span class="token operator">+=</span> msg<span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">checkGoalReached</span><span class="token punctuation">(</span><span class="token builtin">uint</span> campaignID<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span> reached<span class="token punctuation">)</span><span class="token punctuation">{</span>
        Campaign <span class="token keyword">storage</span> c <span class="token operator">=</span> campaigns<span class="token punctuation">[</span>campaignID<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">)</span>c<span class="token punctuation">.</span>amount <span class="token operator">&lt;</span> c<span class="token punctuation">.</span>fundingGoal<span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token builtin">uint</span> amount <span class="token operator">=</span> c<span class="token punctuation">.</span>amount<span class="token punctuation">;</span>
        c<span class="token punctuation">.</span>amount <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
        c<span class="token punctuation">.</span>beneficiary<span class="token punctuation">.</span><span class="token function">transfer</span><span class="token punctuation">(</span>amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br></div></div><p>上面的合约只是一个简化版的 众筹合约，但它已经足以让我们理解结构体的基础概念。 结构体类型可以作为元素用在映射和数组中，其自身也可以包含映射和数组作为成员变量。</p> <p>尽管结构体本身可以作为映射的值类型成员，但它并不能包含自身。 这个限制是有必要的，因为结构体的大小必须是有限的。</p> <p>注意在函数中使用结构体时，一个结构体是如何赋值给一个存储位置是 存储storage 的局部变量。 在这个过程中并没有拷贝这个结构体，而是保存一个引用，所以对局部变量成员的赋值实际上会被写入状态。</p> <p>当然，你也可以直接访问结构体的成员而不用将其赋值给一个局部变量，就像这样， campaigns[campaignID].amount = 0。</p> <p>注解</p> <p>在 Solidity 0.7.0 之前，在 内存memory 结构体包含仅 存储storage 的类型(例如映射)可以允许类似上例中的 campaigns[campaignID] = Campaign(beneficiary, goal, 0, 0)赋值，它会直接忽略映射类型。</p> <p>映射
映射类型在声明时的形式为 mapping(_KeyType =&gt; _ValueType)。 其中 _KeyType 可以是任何基本类型，即可以是任何的内建类型加上<code>bytes</code> 和 string。 而用户定义的类型或复杂的类型如：合约类型、枚举、映射、结构体、即除 bytes 和 string 之外的数组类型 是不可以作为 _KeyType 的类型的。</p> <p>_ValueType 可以是包括映射类型在内的任何类型。</p> <p>映射可以视作 哈希表 ，它们在实际的初始化过程中创建每个可能的 key， 并将其映射到字节形式全是零的值：一个类型的 默认值。然而下面是映射与哈希表不同的地方： 在映射中，实际上并不存储 key，而是存储它的 keccak256 哈希值，从而便于查询实际的值。</p> <p>正因为如此，映射是没有长度的，也没有 key 的集合或 value 的集合的概念。 ，因此如果没有其他信息键的信息是无法被删除(请参阅 Clearing Mappings )。</p> <p>映射只能是 存储storage 的数据位置，因此只允许作为状态变量 或 作为函数内的 存储storage 引用 或 作为库函数的参数。 它们不能用合约公有函数的参数或返回值。</p> <p>这些限制同样适用于包含映射的数组和结构体。</p> <p>可以将映射声明为 public ，然后来让 Solidity 创建一个 getter 函数。 _KeyType 将成为 getter 的必须参数，并且 getter 会返回 _ValueType 。</p> <p>如果 _ValueType 是一个映射。这时在使用 getter 时将需要递归地传入每个 _KeyType 参数，</p> <p>在下面的示例中，　MappingExample 　合约定义了一个公共　balances　映射，键类型为 address，值类型为 uint， 将以太坊地址映射为 无符号整数值。 由于　uint　是值类型，因此getter返回与该类型匹配的值， 可以在　MappingLBC　合约中看到合约在指定地址返回该值。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MappingExample</span> <span class="token punctuation">{</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token keyword">public</span> balances<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">update</span><span class="token punctuation">(</span><span class="token builtin">uint</span> newBalance<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        balances<span class="token punctuation">[</span>msg<span class="token punctuation">.</span>sender<span class="token punctuation">]</span> <span class="token operator">=</span> newBalance<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">contract</span> <span class="token class-name">MappingLBC</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        MappingExample m <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">MappingExample</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        m<span class="token punctuation">.</span><span class="token function">update</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> m<span class="token punctuation">.</span><span class="token function">balances</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br></div></div><p>下面的例子是　ERC20 token　的简单版本． _allowances 是一个嵌套mapping的例子． _allowances 用来记录其他的账号，可以允许从其账号使用多少数量的币．</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.22</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">MappingExample</span> <span class="token punctuation">{</span>

    <span class="token keyword">mapping</span><span class="token punctuation">)</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token keyword">private</span> _balances<span class="token punctuation">;</span>
    <span class="token keyword">mapping</span><span class="token punctuation">)</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token keyword">mapping</span><span class="token punctuation">)</span><span class="token builtin">address</span> <span class="token operator">=&gt;</span> <span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token keyword">private</span> _allowances<span class="token punctuation">;</span>

    <span class="token keyword">event</span> <span class="token function">Transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> <span class="token keyword">from</span><span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> to<span class="token punctuation">,</span> <span class="token builtin">uint256</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">event</span> <span class="token function">Approval</span><span class="token punctuation">(</span><span class="token builtin">address</span> <span class="token keyword">indexed</span> owner<span class="token punctuation">,</span> <span class="token builtin">address</span> <span class="token keyword">indexed</span> spender<span class="token punctuation">,</span> <span class="token builtin">uint256</span> value<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">allowance</span><span class="token punctuation">(</span><span class="token builtin">address</span> owner<span class="token punctuation">,</span> <span class="token builtin">address</span> spender<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint256</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> _allowances<span class="token punctuation">[</span>owner<span class="token punctuation">]</span><span class="token punctuation">[</span>spender<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">transferFrom</span><span class="token punctuation">(</span><span class="token builtin">address</span> sender<span class="token punctuation">,</span> <span class="token builtin">address</span> recipient<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token function">_transfer</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> recipient<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token function">approve</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> msg<span class="token punctuation">.</span>sender<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">approve</span><span class="token punctuation">(</span><span class="token builtin">address</span> owner<span class="token punctuation">,</span> <span class="token builtin">address</span> spender<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>owner <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;ERC20: approve from the zero address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>spender <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;ERC20: approve to the zero address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _allowances<span class="token punctuation">[</span>owner<span class="token punctuation">]</span><span class="token punctuation">[</span>spender<span class="token punctuation">]</span> <span class="token operator">=</span> amount<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">Approval</span><span class="token punctuation">(</span>owner<span class="token punctuation">,</span> spender<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">_transfer</span><span class="token punctuation">(</span><span class="token builtin">address</span> sender<span class="token punctuation">,</span> <span class="token builtin">address</span> recipient<span class="token punctuation">,</span> <span class="token builtin">uint256</span> amount<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token punctuation">{</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>sender <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;ERC20: transfer from the zero address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token keyword">require</span><span class="token punctuation">(</span>recipient <span class="token operator">!=</span> <span class="token builtin">address</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token string">&quot;ERC20: transfer to the zero address&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        _balances<span class="token punctuation">[</span>sender<span class="token punctuation">]</span> <span class="token operator">-=</span> amount<span class="token punctuation">;</span>
        _balances<span class="token punctuation">[</span>recipient<span class="token punctuation">]</span> <span class="token operator">+=</span> amount<span class="token punctuation">;</span>
        <span class="token keyword">emit</span> <span class="token function">Transfer</span><span class="token punctuation">(</span>sender<span class="token punctuation">,</span> recipient<span class="token punctuation">,</span> amount<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br></div></div><p>可迭代映射
映射本身是无法遍历的，即无法枚举所有的键。不过，可以在它们之上实现一个数据结构来进行迭代。 例如，以下代码实现了 IterableMapping 库，然后　User 合约可以添加数据，　sum　函数迭代求和所有值。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.6.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">struct</span> <span class="token class-name">IndexValue</span> <span class="token punctuation">{</span> <span class="token builtin">uint</span> keyIndex<span class="token punctuation">;</span> <span class="token builtin">uint</span> value<span class="token punctuation">;</span> <span class="token punctuation">}</span>
<span class="token keyword">struct</span> <span class="token class-name">KeyFlag</span> <span class="token punctuation">{</span> <span class="token builtin">uint</span> key<span class="token punctuation">;</span> <span class="token builtin">bool</span> deleted<span class="token punctuation">;</span> <span class="token punctuation">}</span>

<span class="token keyword">struct</span> <span class="token class-name">itmap</span> <span class="token punctuation">{</span>
    <span class="token keyword">mapping</span><span class="token punctuation">(</span><span class="token builtin">uint</span> <span class="token operator">=&gt;</span> IndexValue<span class="token punctuation">)</span>data<span class="token punctuation">;</span>
    KeyFlag<span class="token punctuation">[</span><span class="token punctuation">]</span> keys<span class="token punctuation">;</span>
    <span class="token builtin">uint</span> size<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">library</span> <span class="token class-name">IterableMapping</span> <span class="token punctuation">{</span>
    <span class="token keyword">function</span> <span class="token function">insert</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">,</span> <span class="token builtin">uint</span> key<span class="token punctuation">,</span> <span class="token builtin">uint</span> value<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span> replaced<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token builtin">uint</span> keyIndex <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>keyIndex<span class="token punctuation">;</span>
        self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>value <span class="token operator">=</span> value<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">)</span>keyIndex <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        <span class="token keyword">else</span> <span class="token punctuation">{</span>
            keyIndex <span class="token operator">=</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>

            self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span><span class="token function">push</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>keyIndex <span class="token operator">=</span> keyIndex <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">;</span>
            self<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>key <span class="token operator">=</span> key<span class="token punctuation">;</span>
            self<span class="token punctuation">.</span>size<span class="token operator">++</span><span class="token punctuation">;</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">remove</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">,</span> <span class="token builtin">uint</span> key<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span> success<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token builtin">uint</span> keyIndex <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>keyIndex<span class="token punctuation">;</span>
        <span class="token keyword">if</span><span class="token punctuation">)</span>keyIndex <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
            <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span>
        <span class="token keyword">delete</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">;</span>
        self<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>keyIndex <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span>deleted <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">;</span>
        self<span class="token punctuation">.</span>size <span class="token operator">--</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">contains</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">,</span> <span class="token builtin">uint</span> key<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>keyIndex <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">iterate_start</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> keyIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> <span class="token function">iterate_next</span><span class="token punctuation">(</span>self<span class="token punctuation">,</span> <span class="token function">type</span><span class="token punctuation">(</span><span class="token builtin">uint</span><span class="token punctuation">)</span><span class="token punctuation">.</span>max<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">iterate_valid</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">,</span> <span class="token builtin">uint</span> keyIndex<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">bool</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">return</span> keyIndex <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>length<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">iterate_next</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">,</span> <span class="token builtin">uint</span> keyIndex<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> r_keyIndex<span class="token punctuation">)</span><span class="token punctuation">{</span>
        keyIndex<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">while</span><span class="token punctuation">)</span>keyIndex <span class="token operator">&lt;</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">.</span>length <span class="token operator">&amp;&amp;</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>deleted<span class="token punctuation">)</span>
            keyIndex<span class="token operator">++</span><span class="token punctuation">;</span>
        <span class="token keyword">return</span> keyIndex<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">function</span> <span class="token function">iterate_get</span><span class="token punctuation">(</span>itmap <span class="token keyword">storage</span> self<span class="token punctuation">,</span> <span class="token builtin">uint</span> keyIndex<span class="token punctuation">)</span><span class="token keyword">internal</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> key<span class="token punctuation">,</span> <span class="token builtin">uint</span> value<span class="token punctuation">)</span><span class="token punctuation">{</span>
        key <span class="token operator">=</span> self<span class="token punctuation">.</span>keys<span class="token punctuation">[</span>keyIndex<span class="token punctuation">]</span><span class="token punctuation">.</span>key<span class="token punctuation">;</span>
        value <span class="token operator">=</span> self<span class="token punctuation">.</span>data<span class="token punctuation">[</span>key<span class="token punctuation">]</span><span class="token punctuation">.</span>value<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// 如何使用</span>
<span class="token keyword">contract</span> <span class="token class-name">User</span> <span class="token punctuation">{</span>
    <span class="token comment">// Just a struct holding our data.</span>
    itmap data<span class="token punctuation">;</span>
    <span class="token comment">// Apply library functions to the data type.</span>
    <span class="token keyword">using</span> <span class="token class-name">IterableMapping</span> <span class="token keyword">for</span> itmap<span class="token punctuation">;</span>

    <span class="token comment">// Insert something</span>
    <span class="token keyword">function</span> <span class="token function">insert</span><span class="token punctuation">(</span><span class="token builtin">uint</span> k<span class="token punctuation">,</span> <span class="token builtin">uint</span> v<span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> size<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token comment">// This calls IterableMapping.insert(data, k, v)</span>
        data<span class="token punctuation">.</span><span class="token function">insert</span><span class="token punctuation">(</span>k<span class="token punctuation">,</span> v<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token comment">// We can still access members of the struct,</span>
        <span class="token comment">// but we should take care not to mess with them.</span>
        <span class="token keyword">return</span> data<span class="token punctuation">.</span>size<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>

    <span class="token comment">// Computes the sum of all stored data.</span>
    <span class="token keyword">function</span> <span class="token function">sum</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token keyword">view</span> <span class="token keyword">returns</span><span class="token punctuation">)</span><span class="token builtin">uint</span> s<span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">for</span><span class="token punctuation">)</span>
            <span class="token builtin">uint</span> i <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">iterate_start</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            data<span class="token punctuation">.</span><span class="token function">iterate_valid</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            i <span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">iterate_next</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span>
        <span class="token punctuation">)</span><span class="token punctuation">{</span>
           <span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">uint</span> value<span class="token punctuation">)</span><span class="token operator">=</span> data<span class="token punctuation">.</span><span class="token function">iterate_get</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">;</span>
            s <span class="token operator">+=</span> value<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br></div></div><p>涉及 LValues 的运算符
如果 a 是一个 LValue(即一个变量或者其它可以被赋值的东西)，以下运算符都可以使用简写：</p> <p>a += e 等同于 a = a + e。 其它运算符 -=， *=， /=， %=， |=， &amp;= 以及 ^= 都是如此定义的。 a++ 和 a-- 分别等同于 a += 1 和 a -= 1，但表达式本身的值等于 a 在计算之前的值。 与之相反，--a 和 ++a 虽然最终 a 的结果与之前的表达式相同，但表达式的返回值是计算之后的值。</p> <p>delete
delete a 的结果是将 a 类型初始值赋值给 a。即对于整型变量来说，相当于 a = 0，delete 也适用于数组，对于动态数组来说，是将重置为数组长度为0的数组，而对于静态数组来说，是将数组中的所有元素重置为初始值。对数组而言，delete a[x] 仅删除数组索引 x 处的元素，其他的元素和长度不变，这以为着数组中留出了一个空位。如果打算删除项，映射可能是更好的选择。</p> <p>如果对象 a 是结构体，则将结构体中的所有属性(成员)重置。</p> <p>换句话说，在 delete a 之后 a 的值与在没有赋值的情况下声明 a 的情况相同， 但需要注意以下几点：</p> <p>delete 对整个映射是无效的(因为映射的键可以是任意的，通常也是未知的)。 因此在你删除一个结构体时，结果将重置所有的非映射属性(成员)，这个过程是递归进行的，除非它们是映射。 然而，单个的键及其映射的值是可以被删除的。</p> <p>理解 delete a 的效果就像是给 a 赋值很重要，换句话说，这相当于在 a 中存储了一个新的对象。</p> <p>当 a 是应用变量时，我们可以看到这个区别，delete a 它只会重置 a 本身，而不是更改它之前引用的值。</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token comment">// SPDX-License-Identifier: GPL-3.0</span>
<span class="token keyword">pragma</span> <span class="token keyword">solidity</span> <span class="token operator">&gt;=</span><span class="token version number">0.4.0</span> <span class="token operator">&lt;</span><span class="token version number">0.9.0</span><span class="token punctuation">;</span>

<span class="token keyword">contract</span> <span class="token class-name">DeleteLBC</span> <span class="token punctuation">{</span>
    <span class="token builtin">uint</span> data<span class="token punctuation">;</span>
    <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> dataArray<span class="token punctuation">;</span>

    <span class="token keyword">function</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token keyword">public</span> <span class="token punctuation">{</span>
        <span class="token builtin">uint</span> x <span class="token operator">=</span> data<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> x<span class="token punctuation">;</span> <span class="token comment">// 将 x 设为 0，并不影响数据</span>
        <span class="token keyword">delete</span> data<span class="token punctuation">;</span> <span class="token comment">// 将 data 设为 0，并不影响 x，因为它仍然有个副本</span>
        <span class="token builtin">uint</span><span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token keyword">storage</span> y <span class="token operator">=</span> dataArray<span class="token punctuation">;</span>
        <span class="token keyword">delete</span> dataArray<span class="token punctuation">;</span>
        <span class="token comment">// 将 dataArray.length 设为 0，但由于 uint[] 是一个复杂的对象，y 也将受到影响，</span>
        <span class="token comment">// 因为它是一个存储位置是 storage 的对象的别名。</span>
        <span class="token comment">// 另一方面：&quot;delete y&quot; 是非法的，引用了 storage 对象的局部变量只能由已有的 storage 对象赋值。</span>
        <span class="token keyword">assert</span><span class="token punctuation">(</span>y<span class="token punctuation">.</span>length <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><p>基本类型之间的转换
隐式转换
在某些情况下，编译器会自动进行隐式类型转换， 这些情况包括: 在赋值, 参数传递给函数以及应用运算符时。 通常，如果可以进行值类型之间的隐式转换， 并且不会丢失任何信息。 都是可以隐式类型转换</p> <p>例如, uint8 可以转换成 uint16，int128 转换成 int256，但 int8 不能转换成 uint256)因为 uint256 不能涵盖某些值，例如，-1)。</p> <p>如果将运算符应用于不同的类型，则编译器将尝试将其中一个操作数隐式转换为另一个操作数的类型(赋值也是如此)。 这意味着操作始终以操作数之一的类型执行。</p> <p>有关可能进行哪些隐式转换的更多详细信息， 请查阅有关类型本身的内容。</p> <p>在下面的示例中，加法的操作数 y 和 z 没有相同的类型，但是 uint8 可以被隐式转换为 uint16，相反却不可以。 因此， 在执行加法之前，将 y 转换为 z 的类型，　在<code>uint16</code>　类型中。 表达式　 y + z 　的结果类型是　uint16　。 在执行加法之后。　因为它被赋值给　uint32　类型的变量，又进行了另一个隐式转换.</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">uint8</span> y<span class="token punctuation">;</span>
<span class="token builtin">uint16</span> z<span class="token punctuation">;</span>
<span class="token builtin">uint32</span> x <span class="token operator">=</span> y <span class="token operator">+</span> z<span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>显式转换
如果某些情况下编译器不支持隐式转换，但是你很清楚你要做的结果，这种情况可以考虑显式转换。 注意这可能会发生一些无法预料的后果，因此一定要进行测试，确保结果是你想要的！ 下面的示例是将一个 int8 类型的负数转换成 uint：</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">int8</span> y <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span class="token punctuation">;</span>
<span class="token builtin">uint</span> x <span class="token operator">=</span> <span class="token builtin">uint</span><span class="token punctuation">(</span>y<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>这段代码的最后，x 的值将是 0xfffff..fd)64 个 16 进制字符)，因为这是 -3 的 256 位补码形式。</p> <p>如果一个类型显式转换成更小的类型，相应的高位将被舍弃</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">uint32</span> a <span class="token operator">=</span> <span class="token number">0x12345678</span><span class="token punctuation">;</span>
<span class="token builtin">uint16</span> b <span class="token operator">=</span> <span class="token builtin">uint16</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 此时 b 的值是 0x5678</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果将整数显式转换为更大的类型，则将填充左侧(即在更高阶的位置)。 转换结果依旧等于原来整数</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">uint16</span> a <span class="token operator">=</span> <span class="token number">0x1234</span><span class="token punctuation">;</span>
<span class="token builtin">uint32</span> b <span class="token operator">=</span> <span class="token builtin">uint32</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b 为 0x00001234 now</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>a <span class="token operator">==</span> b<span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>定长字节数组转换则有所不同， 他们可以被认为是单个字节的序列和转换为较小的类型将切断序列</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">bytes2</span> a <span class="token operator">=</span> <span class="token number">0x1234</span><span class="token punctuation">;</span>
<span class="token builtin">bytes1</span> b <span class="token operator">=</span> <span class="token builtin">bytes1</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b 为 0x12</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p>如果将定长字节数组显式转换为更大的类型，将按正确的方式填充。 以固定索引访问转换后的字节将在和之前的值相等)如果索引仍然在范围内):</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">bytes2</span> a <span class="token operator">=</span> <span class="token number">0x1234</span><span class="token punctuation">;</span>
<span class="token builtin">bytes4</span> b <span class="token operator">=</span> <span class="token builtin">bytes4</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b 为 0x12340000</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token keyword">assert</span><span class="token punctuation">(</span>a<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">==</span> b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><p>因为整数和定长字节数组在截断(或填充)时行为是不同的， 如果整数和定长字节数组有相同的大小，则允许他们之间进行显式转换， 如果要在不同的大小的整数和定长字节数组之间进行转换 ，必须使用一个中间类型来明确进行所需截断和填充的规则:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">bytes2</span> a <span class="token operator">=</span> <span class="token number">0x1234</span><span class="token punctuation">;</span>
<span class="token builtin">uint32</span> b <span class="token operator">=</span> <span class="token builtin">uint16</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// b 为 0x00001234</span>
<span class="token builtin">uint32</span> c <span class="token operator">=</span> <span class="token builtin">uint32</span><span class="token punctuation">(</span><span class="token builtin">bytes4</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// c 为 0x12340000</span>
<span class="token builtin">uint8</span> d <span class="token operator">=</span> <span class="token builtin">uint8</span><span class="token punctuation">(</span><span class="token builtin">uint16</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// d 为 0x34</span>
<span class="token builtin">uint8</span> e <span class="token operator">=</span> <span class="token builtin">uint8</span><span class="token punctuation">(</span><span class="token builtin">bytes1</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// e 为 0x12</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><p>字面常量与基本类型的转换
整型与字面常量转换
十进制和十六进制字面常量可以隐式转换为任何足以表示它而不会截断的整数类型</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">uint8</span> a <span class="token operator">=</span> <span class="token number">12</span><span class="token punctuation">;</span> <span class="token comment">//  可行</span>
<span class="token builtin">uint32</span> b <span class="token operator">=</span> <span class="token number">1234</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
<span class="token builtin">uint16</span> c <span class="token operator">=</span> <span class="token number">0x123456</span><span class="token punctuation">;</span> <span class="token comment">// 失败, 会截断为 0x3456</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><p>注解</p> <p>在 0.8.0 之前, 任何十进制和十六进制常量都可以显示转化为整型，不过从0.8.0开始，只有在匹配数据范围时，才能进行这个转换，就像隐式转换那样。</p> <p>定长字节数组与字面常量转换
十进制字面常量不能隐式转换为定长字节数组。十六进制字面常量可以是，但仅当十六进制数字大小完全符合定长字节数组长度。 不过零值例外，零的十进制和十六进制字面常量都可以转换为任何定长字节数组类型:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">bytes2</span> a <span class="token operator">=</span> <span class="token number">54321</span><span class="token punctuation">;</span> <span class="token comment">// 不可行</span>
<span class="token builtin">bytes2</span> b <span class="token operator">=</span> <span class="token number">0x12</span><span class="token punctuation">;</span> <span class="token comment">// 不可行</span>
<span class="token builtin">bytes2</span> c <span class="token operator">=</span> <span class="token number">0x123</span><span class="token punctuation">;</span> <span class="token comment">// 不可行</span>
<span class="token builtin">bytes2</span> d <span class="token operator">=</span> <span class="token number">0x1234</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
<span class="token builtin">bytes2</span> e <span class="token operator">=</span> <span class="token number">0x0012</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
<span class="token builtin">bytes4</span> f <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
<span class="token builtin">bytes4</span> g <span class="token operator">=</span> <span class="token number">0x0</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><p>字符串字面常量和十六进制字符串字面常量可以隐式转换为定长字节数组，如果它们的字符数与字节类型的大小相匹配:</p> <div class="language-sol line-numbers-mode"><pre class="language-sol"><code><span class="token builtin">bytes2</span> a <span class="token operator">=</span> hex<span class="token string">&quot;1234&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
<span class="token builtin">bytes2</span> b <span class="token operator">=</span> <span class="token string">&quot;xy&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 可行</span>
<span class="token builtin">bytes2</span> c <span class="token operator">=</span> hex<span class="token string">&quot;12&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 不可行</span>
<span class="token builtin">bytes2</span> d <span class="token operator">=</span> hex<span class="token string">&quot;123&quot;</span><span class="token punctuation">;</span> <span class="token comment">// n不可行</span>
<span class="token builtin">bytes2</span> e <span class="token operator">=</span> <span class="token string">&quot;x&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 不可行</span>
<span class="token builtin">bytes2</span> f <span class="token operator">=</span> <span class="token string">&quot;xyz&quot;</span><span class="token punctuation">;</span> <span class="token comment">// 不可行</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>地址类型
参考 地址字面常量 ，通过校验和测试的正确大小的十六进制字面常量会作为 address 类型。没有其他字面常量可以隐式转换为 address 类型。</p> <p>从 bytes20 或其他整型显示转换为 address 类型时，都会作为 address payable 类型。</p> <p>一个地址 address a 可以通过<code>payable(a)</code>　转换为　 address payable 类型.</p></div></section> <footer class="page-edit"><!----> <!----></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/dapp/solidity/introduction/file.html" class="prev">
            Solidity源文件结构
          </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div> <ul class="side-bar sub-sidebar-wrapper" style="width:12rem;" data-v-106c08ae><li class="level-2" data-v-106c08ae><a href="/dapp/solidity/basis/data-type.html#值类型" class="sidebar-link reco-side-值类型" data-v-106c08ae>值类型</a></li><li class="level-3" data-v-106c08ae><a href="/dapp/solidity/basis/data-type.html#_1-布尔型" class="sidebar-link reco-side-_1-布尔型" data-v-106c08ae>1.布尔型</a></li><li class="level-3" data-v-106c08ae><a href="/dapp/solidity/basis/data-type.html#_2-整型" class="sidebar-link reco-side-_2-整型" data-v-106c08ae>2.整型</a></li><li class="level-3" data-v-106c08ae><a href="/dapp/solidity/basis/data-type.html#_3-定长浮点型" class="sidebar-link reco-side-_3-定长浮点型" data-v-106c08ae>3.定长浮点型</a></li><li class="level-3" data-v-106c08ae><a href="/dapp/solidity/basis/data-type.html#_4-地址类型" class="sidebar-link reco-side-_4-地址类型" data-v-106c08ae>4.地址类型</a></li><li class="level-3" data-v-106c08ae><a href="/dapp/solidity/basis/data-type.html#_5-合约类型" class="sidebar-link reco-side-_5-合约类型" data-v-106c08ae>5.合约类型</a></li></ul></main> <!----></div></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.944974c5.js" defer></script><script src="/assets/js/5.2fa58847.js" defer></script><script src="/assets/js/1.66903a01.js" defer></script><script src="/assets/js/23.14e02022.js" defer></script>
  </body>
</html>
